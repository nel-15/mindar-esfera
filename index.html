<html>
<head>
    <title>MindAR - Componentes de PC (Info Automática)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script> 

    <script>
        // =================================================================
        // NUEVO COMPONENTE: Muestra la información automáticamente al aparecer el modelo
        // =================================================================
        AFRAME.registerComponent('info-auto', {
            schema: {
                info: {type: 'string', default: 'Información no disponible.'}
            },
            init: function () {
                var modelEl = this.el; // La entidad del modelo 3D
                var infoText = this.data.info;
                var targetEl = modelEl.closest('a-entity[mindar-image-target]'); // El marcador padre

                if (!targetEl) return;

                // Función para crear y mostrar el texto
                const displayInfo = () => {
                    // 1. Eliminar texto anterior
                    var oldText = document.getElementById('infoTextAR');
                    if (oldText) {
                        oldText.parentNode.removeChild(oldText);
                    }

                    // 2. Crear la nueva entidad de texto
                    var textEntity = document.createElement('a-entity');
                    
                    textEntity.setAttribute('id', 'infoTextAR');
                    textEntity.setAttribute('text', {
                        value: infoText,
                        color: '#FFFFFF', 
                        wrapCount: 25, 
                        width: 1.2,
                        align: 'center'
                    });
                    
                    // Posicionamos el texto sobre el centro del marcador (Posición 0, 0.6, 0.1 del target)
                    textEntity.setAttribute('position', '0 0.6 0.1'); 
                    
                    // Hace que el texto mire siempre a la cámara
                    textEntity.setAttribute('look-at', '[camera]');

                    // 3. Adjuntar el texto al Target
                    targetEl.appendChild(textEntity);
                };
                
                // Función para ocultar el texto
                const hideInfo = () => {
                    var currentText = document.getElementById('infoTextAR');
                    if (currentText) {
                        currentText.parentNode.removeChild(currentText);
                    }
                };
                

                // 4. ESCUCHAMOS EL EVENTO CUANDO EL MARKER ES ENCONTRADO
                targetEl.addEventListener('targetFound', displayInfo);
                
                // 5. ESCUCHAMOS EL EVENTO CUANDO EL MARKER SE PIERDE
                targetEl.addEventListener('targetLost', hideInfo);
            }
        });
    </script>
</head>
<body>

    <a-scene mindar-image="imageTargetSrc: targets.mind; maxTrack: 3; debug: true;" 
             color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights: true"
             vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">

        <a-assets>
            <a-asset-item id="gpu-modelo" src="./assets/gpu_amd_rx_6700_xt.glb"></a-asset-item>
            <a-asset-item id="ram-modelo" src="./assets/kingston_hyperx_fury_black_ram_module.glb"></a-asset-item>
            <a-asset-item id="cpu-modelo" src="./assets/am4_cpu__free.glb"></a-asset-item>
        </a-assets>

        <a-camera 
            position="0 0 0" 
            look-controls="enabled: false">
        </a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-entity 
                gltf-model="#gpu-modelo" 
                rotation="90 0 0"             
                position="0 0 0.1"            
                scale="0.2 0.2 0.2"  
                animation-mixer
                info-auto="info: La GPU (Tarjeta Gráfica) es el motor de renderizado. Se encarga de procesar y mostrar imágenes, vídeos y gráficos 3D."> </a-entity>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 1">
            <a-entity 
                gltf-model="#ram-modelo" 
                rotation="0 0 0"             
                position="0 0 0.1"            
                scale="0.2 0.2 0.2"  
                animation-mixer
                info-auto="info: La RAM (Memoria de Acceso Aleatorio) es la memoria de trabajo ultrarrápida que usa el CPU para ejecutar los programas que están abiertos."> </a-entity>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 2">
            <a-entity 
                gltf-model="#cpu-modelo" 
                rotation="0 0 0"             
                position="0 0 0.1"            
                scale="0.2 0.2 0.2"  
                animation-mixer
                info-auto="info: El CPU (Procesador) es el cerebro de la computadora. Ejecuta todas las instrucciones de los programas, gestiona las operaciones y el flujo de datos."> </a-entity>
        </a-entity>
    </a-scene>
</body>
</html>
